"use strict";(()=>{var e={};e.id=9564,e.ids=[9564],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},29504:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>ey,originalPathname:()=>eg,patchFetch:()=>ed,requestAsyncStorage:()=>ec,routeModule:()=>eu,serverHooks:()=>el,staticGenerationAsyncStorage:()=>ef,staticGenerationBailout:()=>ep});var n={};r.r(n),r.d(n,{HEAD:()=>es,POST:()=>eo});var a=r(95419),i=r(69108),s=r(99678),o=r(6733),u=r(8624),c=r(16904),f=r(26836),l=r(6037),y=r(24041),p=Object.defineProperty,g={};function d(e){return/^http(s?):/.test(e)||e.startsWith("/")}((e,t)=>{for(var r in t)p(e,r,{get:t[r],enumerable:!0})})(g,{audioClassification:()=>T,audioToAudio:()=>j,automaticSpeechRecognition:()=>H,conversational:()=>I,documentQuestionAnswering:()=>Y,featureExtraction:()=>U,fillMask:()=>X,imageClassification:()=>C,imageSegmentation:()=>S,imageToImage:()=>R,imageToText:()=>B,objectDetection:()=>O,questionAnswering:()=>D,request:()=>v,sentenceSimilarity:()=>F,streamingRequest:()=>_,summarization:()=>G,tableQuestionAnswering:()=>L,tabularClassification:()=>et,tabularRegression:()=>ee,textClassification:()=>M,textGeneration:()=>N,textGenerationStream:()=>W,textToImage:()=>$,textToSpeech:()=>q,tokenClassification:()=>Z,translation:()=>Q,visualQuestionAnswering:()=>V,zeroShotClassification:()=>J,zeroShotImageClassification:()=>z});var m=new Map,w="https://huggingface.co";async function h(e,t,r){if(d(e))return null;let n=`${e}:${t}`,a=m.get(n);if(a&&a.date<new Date(Date.now()-6e5)&&(m.delete(n),a=void 0),void 0===a){let i=await (r?.fetch??fetch)(`${w}/api/models/${e}?expand[]=pipeline_tag`,{headers:t?{Authorization:`Bearer ${t}`}:{}}).then(e=>e.json()).then(e=>e.pipeline_tag).catch(()=>null);if(!i)return null;a={task:i,date:new Date},m.set(n,{task:i,date:new Date}),m.size>1e3&&m.delete(m.keys().next().value)}return a.task}var b="https://api-inference.huggingface.co",x=null;async function A(e,t){let r;let{accessToken:n,model:a,...i}=e,{model:s}=e,{forceTask:o,includeCredentials:u,taskHint:c,...f}=t??{},l={};if(n&&(l.Authorization=`Bearer ${n}`),!s&&!x&&c){let e=await fetch(`${w}/api/tasks`);e.ok&&(x=await e.json())}if(!s&&x&&c){let e=x[c];e&&(s=e.models[0].id)}if(!s)throw Error("No model provided, and no default model found for this task");let y="data"in e&&!!e.data;y?(t?.wait_for_model&&(l["X-Wait-For-Model"]="true"),t?.use_cache===!1&&(l["X-Use-Cache"]="false"),t?.dont_load_model&&(l["X-Load-Model"]="0")):l["Content-Type"]="application/json";let p=d(s)?s:o?`${b}/pipeline/${o}/${s}`:`${b}/models/${s}`;return"string"==typeof u?r=u:"boolean"==typeof u?r=u?"include":void 0:void 0===u&&(r="same-origin"),{url:p,info:{headers:l,method:"POST",body:y?e.data:JSON.stringify({...i,options:t&&f}),credentials:r,signal:t?.signal}}}async function v(e,t){let{url:r,info:n}=await A(e,t),a=await (t?.fetch??fetch)(r,n);if(t?.retry_on_error!==!1&&503===a.status&&!t?.wait_for_model)return v(e,{...t,wait_for_model:!0});if(!a.ok){if(a.headers.get("Content-Type")?.startsWith("application/json")){let e=await a.json();if(e.error)throw Error(e.error)}throw Error("An error occurred while fetching the blob")}return a.headers.get("Content-Type")?.startsWith("application/json")?await a.json():await a.blob()}function k(){return{data:"",event:"",id:"",retry:void 0}}async function*_(e,t){var r;let n,a,i,s;let{url:o,info:u}=await A({...e,stream:!0},t),c=await (t?.fetch??fetch)(o,u);if(t?.retry_on_error!==!1&&503===c.status&&!t?.wait_for_model)return _(e,{...t,wait_for_model:!0});if(!c.ok){if(c.headers.get("Content-Type")?.startsWith("application/json")){let e=await c.json();if(e.error)throw Error(e.error)}throw Error(`Server response contains error: ${c.status}`)}if(!c.headers.get("content-type")?.startsWith("text/event-stream"))throw Error("Server does not support event stream content type, it returned "+c.headers.get("content-type"));if(!c.body)return;let f=c.body.getReader(),l=[],y=(r=function(e,t,r){let n=k(),a=new TextDecoder;return function(i,s){if(0===i.length)r?.(n),n=k();else if(s>0){let r=a.decode(i.subarray(0,s)),o=s+(32===i[s+1]?2:1),u=a.decode(i.subarray(o));switch(r){case"data":n.data=n.data?n.data+"\n"+u:u;break;case"event":n.event=u;break;case"id":e(n.id=u);break;case"retry":let c=parseInt(u,10);isNaN(c)||t(n.retry=c)}}}}(()=>{},()=>{},e=>{l.push(e)}),s=!1,function(e){void 0===n?(n=e,a=0,i=-1):n=function(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}(n,e);let t=n.length,o=0;for(;a<t;){s&&(10===n[a]&&(o=++a),s=!1);let e=-1;for(;a<t&&-1===e;++a)switch(n[a]){case 58:-1===i&&(i=a-o);break;case 13:s=!0;case 10:e=a}if(-1===e)break;r(n.subarray(o,e),i),o=a,i=-1}o===t?n=void 0:0!==o&&(n=n.subarray(o),a-=o)});try{for(;;){let{done:e,value:t}=await f.read();if(e)return;for(let e of(y(t),l))if(e.data.length>0){let t=JSON.parse(e.data);if("object"==typeof t&&null!==t&&"error"in t)throw Error(t.error);yield t}l=[]}}finally{f.releaseLock()}}var E=class extends TypeError{constructor(e){super(`Invalid inference output: ${e}. Use the 'request' method with the same parameters to do a custom call with no type checking.`),this.name="InferenceOutputError"}};async function T(e,t){let r=await v(e,{...t,taskHint:"audio-classification"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e.label&&"number"==typeof e.score)))throw new E("Expected Array<{label: string, score: number}>");return r}async function H(e,t){let r=await v(e,{...t,taskHint:"automatic-speech-recognition"});if("string"!=typeof r?.text)throw new E("Expected {text: string}");return r}async function q(e,t){let r=await v(e,{...t,taskHint:"text-to-speech"});if(!(r&&r instanceof Blob))throw new E("Expected Blob");return r}async function j(e,t){let r=await v(e,{...t,taskHint:"audio-to-audio"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e.label&&"string"==typeof e.blob&&"string"==typeof e["content-type"])))throw new E("Expected Array<{label: string, blob: string, content-type: string}>");return r}async function C(e,t){let r=await v(e,{...t,taskHint:"image-classification"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e.label&&"number"==typeof e.score)))throw new E("Expected Array<{label: string, score: number}>");return r}async function S(e,t){let r=await v(e,{...t,taskHint:"image-segmentation"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e.label&&"string"==typeof e.mask&&"number"==typeof e.score)))throw new E("Expected Array<{label: string, mask: string, score: number}>");return r}async function B(e,t){let r=(await v(e,{...t,taskHint:"image-to-text"}))?.[0];if("string"!=typeof r?.generated_text)throw new E("Expected {generated_text: string}");return r}async function O(e,t){let r=await v(e,{...t,taskHint:"object-detection"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e.label&&"number"==typeof e.score&&"number"==typeof e.box.xmin&&"number"==typeof e.box.ymin&&"number"==typeof e.box.xmax&&"number"==typeof e.box.ymax)))throw new E("Expected Array<{label:string; score:number; box:{xmin:number; ymin:number; xmax:number; ymax:number}}>");return r}async function $(e,t){let r=await v(e,{...t,taskHint:"text-to-image"});if(!(r&&r instanceof Blob))throw new E("Expected Blob");return r}function P(e){if(globalThis.Buffer)return globalThis.Buffer.from(e).toString("base64");{let t=[];return e.forEach(e=>{t.push(String.fromCharCode(e))}),globalThis.btoa(t.join(""))}}async function R(e,t){let r;r=e.parameters?{...e,inputs:P(new Uint8Array(e.inputs instanceof ArrayBuffer?e.inputs:await e.inputs.arrayBuffer()))}:{accessToken:e.accessToken,model:e.model,data:e.inputs};let n=await v(r,{...t,taskHint:"image-to-image"});if(!(n&&n instanceof Blob))throw new E("Expected Blob");return n}async function z(e,t){let r={...e,inputs:{image:P(new Uint8Array(e.inputs.image instanceof ArrayBuffer?e.inputs.image:await e.inputs.image.arrayBuffer()))}},n=await v(r,{...t,taskHint:"zero-shot-image-classification"});if(!(Array.isArray(n)&&n.every(e=>"string"==typeof e.label&&"number"==typeof e.score)))throw new E("Expected Array<{label: string, score: number}>");return n}async function I(e,t){let r=await v(e,{...t,taskHint:"conversational"});if(!(Array.isArray(r.conversation.generated_responses)&&r.conversation.generated_responses.every(e=>"string"==typeof e)&&Array.isArray(r.conversation.past_user_inputs)&&r.conversation.past_user_inputs.every(e=>"string"==typeof e)&&"string"==typeof r.generated_text&&(void 0===r.warnings||Array.isArray(r.warnings)&&r.warnings.every(e=>"string"==typeof e))))throw new E("Expected {conversation: {generated_responses: string[], past_user_inputs: string[]}, generated_text: string, warnings: string[]}");return r}async function U(e,t){let r=e.model?await h(e.model,e.accessToken,t):void 0,n=await v(e,{...t,taskHint:"feature-extraction",..."sentence-similarity"===r&&{forceTask:"feature-extraction"}}),a=(e,t,r=0)=>!(r>t)&&(e.every(e=>Array.isArray(e))?e.every(e=>a(e,t,r+1)):e.every(e=>"number"==typeof e));if(!(Array.isArray(n)&&a(n,3,0)))throw new E("Expected Array<number[][][] | number[][] | number[] | number>");return n}async function X(e,t){let r=await v(e,{...t,taskHint:"fill-mask"});if(!(Array.isArray(r)&&r.every(e=>"number"==typeof e.score&&"string"==typeof e.sequence&&"number"==typeof e.token&&"string"==typeof e.token_str)))throw new E("Expected Array<{score: number, sequence: string, token: number, token_str: string}>");return r}async function D(e,t){let r=await v(e,{...t,taskHint:"question-answering"});if(!("object"==typeof r&&r&&"string"==typeof r.answer&&"number"==typeof r.end&&"number"==typeof r.score&&"number"==typeof r.start))throw new E("Expected {answer: string, end: number, score: number, start: number}");return r}async function F(e,t){let r=e.model?await h(e.model,e.accessToken,t):void 0,n=await v(e,{...t,taskHint:"sentence-similarity",..."feature-extraction"===r&&{forceTask:"sentence-similarity"}});if(!(Array.isArray(n)&&n.every(e=>"number"==typeof e)))throw new E("Expected number[]");return n}async function G(e,t){let r=await v(e,{...t,taskHint:"summarization"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e?.summary_text)))throw new E("Expected Array<{summary_text: string}>");return r?.[0]}async function L(e,t){let r=await v(e,{...t,taskHint:"table-question-answering"});if(!("string"==typeof r?.aggregator&&"string"==typeof r.answer&&Array.isArray(r.cells)&&r.cells.every(e=>"string"==typeof e)&&Array.isArray(r.coordinates)&&r.coordinates.every(e=>Array.isArray(e)&&e.every(e=>"number"==typeof e))))throw new E("Expected {aggregator: string, answer: string, cells: string[], coordinates: number[][]}");return r}async function M(e,t){let r=(await v(e,{...t,taskHint:"text-classification"}))?.[0];if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e?.label&&"number"==typeof e.score)))throw new E("Expected Array<{label: string, score: number}>");return r}async function N(e,t){let r=await v(e,{...t,taskHint:"text-generation"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e?.generated_text)))throw new E("Expected Array<{generated_text: string}>");return r?.[0]}async function*W(e,t){yield*_(e,{...t,taskHint:"text-generation"})}function K(e){return Array.isArray(e)?e:[e]}async function Z(e,t){let r=K(await v(e,{...t,taskHint:"token-classification"}));if(!(Array.isArray(r)&&r.every(e=>"number"==typeof e.end&&"string"==typeof e.entity_group&&"number"==typeof e.score&&"number"==typeof e.start&&"string"==typeof e.word)))throw new E("Expected Array<{end: number, entity_group: string, score: number, start: number, word: string}>");return r}async function Q(e,t){let r=await v(e,{...t,taskHint:"translation"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e?.translation_text)))throw new E("Expected type Array<{translation_text: string}>");return r?.[0]}async function J(e,t){let r=K(await v(e,{...t,taskHint:"zero-shot-classification"}));if(!(Array.isArray(r)&&r.every(e=>Array.isArray(e.labels)&&e.labels.every(e=>"string"==typeof e)&&Array.isArray(e.scores)&&e.scores.every(e=>"number"==typeof e)&&"string"==typeof e.sequence)))throw new E("Expected Array<{labels: string[], scores: number[], sequence: string}>");return r}async function Y(e,t){let r={...e,inputs:{question:e.inputs.question,image:P(new Uint8Array(e.inputs.image instanceof ArrayBuffer?e.inputs.image:await e.inputs.image.arrayBuffer()))}},n=K(await v(r,{...t,taskHint:"document-question-answering"}))?.[0];if(!("string"==typeof n?.answer&&("number"==typeof n.end||void 0===n.end)&&("number"==typeof n.score||void 0===n.score)&&("number"==typeof n.start||void 0===n.start)))throw new E("Expected Array<{answer: string, end?: number, score?: number, start?: number}>");return n}async function V(e,t){let r={...e,inputs:{question:e.inputs.question,image:P(new Uint8Array(e.inputs.image instanceof ArrayBuffer?e.inputs.image:await e.inputs.image.arrayBuffer()))}},n=(await v(r,{...t,taskHint:"visual-question-answering"}))?.[0];if(!("string"==typeof n?.answer&&"number"==typeof n.score))throw new E("Expected Array<{answer: string, score: number}>");return n}async function ee(e,t){let r=await v(e,{...t,taskHint:"tabular-regression"});if(!(Array.isArray(r)&&r.every(e=>"number"==typeof e)))throw new E("Expected number[]");return r}async function et(e,t){let r=await v(e,{...t,taskHint:"tabular-classification"});if(!(Array.isArray(r)&&r.every(e=>"number"==typeof e)))throw new E("Expected number[]");return r}"object"==typeof self&&self.constructor&&self.constructor.name;var er=class{constructor(e="",t={}){for(let[r,n]of(this.accessToken=e,this.defaultOptions=t,Object.entries(g)))Object.defineProperty(this,r,{enumerable:!1,value:(r,a)=>n({...r,accessToken:e},{...t,...a})})}endpoint(e){return new en(e,this.accessToken,this.defaultOptions)}},en=class{constructor(e,t="",r={}){for(let[n,a]of Object.entries(g))Object.defineProperty(this,n,{enumerable:!1,value:(n,i)=>a({...n,accessToken:t,model:e},{...r,...i})})}},ea=r(66285),ei=r(51444);async function es(){return Response.json("",{status:o.Xd?.apiKey?200:401})}async function eo(e){if(o.Xd?.config?.apiKey?.toLowerCase()!=="huggingface")return Response.json("You are not using Huggingface as your provider.",{status:400});let{messages:t}=await e.json();t=(0,y.D)({messages:t});let r=e.headers.get("model"),n=e.headers.get("promptType"),a=await l.Z.getLanguage(),i=await l.Z.getIdeLanguage();if(n){let e=(0,c.u)({promptType:t[t.length-1].content,cleanPromptText:await l.Z.getSelectedText(),language:i});e&&(t[t.length-1].content=e)}t.unshift({role:"assistant",content:"I am a helpful programming expert assistant. If you ask me a question that is rooted in truth. Follow the user's instructions with precision and attention to detail. Provide the code in a single block. Minimize any additional text."});let s=await l.Z.getSelectedText();s&&(t[t.length-1].content+="\n```"+a+"\n"+s+"\n```");try{let e=async(e,a)=>{let i=await fetch(e,a);return i.ok||(0,u.q)({promptType:n?t[t.length-1].content+"CodeGPT":"Chat",isAnonymous:!0,provider:"HuggingFace",model:r||"OpenAssistant/oasst-sft-4-pythia-12b-epoch-3.5",statusCode:i.status}),i},i=new er(o.Xd?.apiKey||"",{fetch:e});if(!o.Xd.apiKey){let e=Error("You need to set your Azure details first.");throw e.status=401,e}let c=o.Xd?.globalState?.config,l=i.textGenerationStream({model:r||"OpenAssistant/oasst-sft-4-pythia-12b-epoch-3.5",inputs:(0,ei.y7)(t),parameters:{max_new_tokens:c?.maxTokens||500,temperature:c?.temperature||.7,typical_p:.2,repetition_penalty:1,return_full_text:!1}}),y=(0,ea.lu)(l,{onFinal:()=>{(0,u.q)({promptType:n?t[t.length-1].content+"CodeGPT":"Chat",isAnonymous:!0,provider:"HuggingFace",model:r??"",statusCode:200})}}),p=t.slice(0,-1).some(e=>e.content.includes(s));if(s&&(n||!p)){let e=await (0,f.V)(["```"+a+"\n"+s+"\n```"],y);return new ea.wn(e)}return new ea.wn(y)}catch(e){if((0,u.q)({promptType:n?t[t.length-1].content+"CodeGPT":"Chat",isAnonymous:!0,provider:"HuggingFace",model:r||"OpenAssistant/oasst-sft-4-pythia-12b-epoch-3.5",statusCode:e.status??500}),e.message.includes("Invalid URL"))return Response.json({message:"Invalid URL",status:401},{status:400});return Response.json({message:e.message,status:e.status??500},{status:e.status??500})}}let eu=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/(providers)/huggingface/route",pathname:"/api/huggingface",filename:"route",bundlePath:"app/api/(providers)/huggingface/route"},resolvedPagePath:"/Users/danipower/Proyectos/Node/vscode-blog/codegpt-nextjs/app/api/(providers)/huggingface/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:ec,staticGenerationAsyncStorage:ef,serverHooks:el,headerHooks:ey,staticGenerationBailout:ep}=eu,eg="/api/(providers)/huggingface/route";function ed(){return(0,s.patchFetch)({serverHooks:el,staticGenerationAsyncStorage:ef})}},51444:(e,t,r)=>{function n(e){return e.map(({content:e,role:t})=>"user"===t?`

Human: ${e}`:`

Assistant: ${e}`)+"\n\nAssistant:"}function a(e){return e.map(({content:e,role:t})=>{if("user"===t)return`<|prompter|>${e}<|endoftext|>`;if("function"===t)throw Error("OpenAssistant does not support function calls.");if("system"!==t)return`<|assistant|>${e}<|endoftext|>`;throw Error("OpenAssistant does not support system messages.")}).join("")+"<|assistant|>"}r.d(t,{C0:()=>n,y7:()=>a})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[1638,3567,3792,9751],()=>r(29504));module.exports=n})();